---
# tasks file for service-authz
- name: Copy files
  block:
    - name: Copy file db_login.env
      ansible.builtin.copy:
        src: ../conf/db/db_login.env
        dest: /etc/db_login.env
        owner: root
        group: root
        mode: '0644'
  become: true
  become_user: root
- name: Work with docker
  block:
  - name: Clone {{ git_branch }} branch
    ansible.builtin.git:
      repo: https://github.com/ESergiusz/dos14-Eremeev-GitFlow.git
      dest: /home/authz/git
      single_branch: yes
      force: yes
      version: "{{ git_branch }}"
  - name: Copy file privkey.pem for decrypt
    ansible.builtin.copy:
      src: ../conf/certbot/privkey.pem
      dest: /home/authz/git/conf/certbot/privkey.pem
      owner: authz
      mode: '0644'
  - name: Build container (docker-compose)
    community.docker.docker_compose:
      project_src: /home/authz/git
  become: true
  become_user: authz
- name: Delete files
  block:
  - name: Delete db_login.env
    ansible.builtin.file:
      path: /etc/db_login.env
      state: absent
  become: true
  become_user: root